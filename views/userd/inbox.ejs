<section>
  <div class="content">
    <div class="container">
      <h1>Inbox</h1>
      <br>

      <% if (receivedFiles && receivedFiles.length > 0) { %>
        <table id="inboxTable">
          <thead>
            <tr>
              <th style="width: 20%">File</th>
              <th style="width: 15%">Sender</th>  
              <th style="width: 15%">Received</th>
              <th style="width: 10%">Attachment</th>
              <th style="width: 10%">Status</th>
              <th style="width: 15%">Comment</th>
              <th style="width: 15%">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% receivedFiles.forEach(item => { %>
              <tr>
                <td><%= item.file_name %></td>
                <td><%= item.sender_name %></td>
                <td><%= new Date(item.sent_at).toLocaleString() %></td>
                <td>
                  <% if (item.attachment_path) { %>
                    <a href="/uploads/<%= item.attachment %>" target="_blank" class="attachment-link">View</a>
                  <% } else { %>
                    No attachment
                  <% } %>
                </td>
                <td><%= item.status %></td>
                <td><%= item.note || '—' %></td>  
                <td>
                  <div class="action-icons">
                    <a href="/userd/view/<%= item.file_id %>" class="action-icon view-icon" title="View Document">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a href="/userd/downloads/<%= item.file_id %>" class="action-icon download-icon" title="Download">
                      <i class="fas fa-download"></i>
                    </a>
                    <a href="/userd/delete/<%= item.id %>" class="action-icon delete-icon" title="Delete">
                      <i class="fas fa-trash"></i>
                    </a>
                  </div>
                </td>
              </tr>
            

             <% }) %>
      <% } else { %>
        <tr>
          <td colspan="9">No files found.</td>
        </tr>
      <% } %>
          </tbody>
        </table>
     

      <div class="userd-actions">
        <a href="/userd" class="b2d-link">Back to Dashboard</a>
      </div>

      

    <!-- ✅ "See More" button -->
      <button id="seeMoreBtn" class="see-more-btn">See more</button>

    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const rows = document.querySelectorAll("#inboxTable tbody tr");
    const seeMoreBtn = document.getElementById("seeMoreBtn");

    const maxVisible = 4; // show only 3 rows initially
    if (rows.length <= maxVisible) {
      seeMoreBtn.style.display = "none"; // hide button if not needed
      return;
    }

    // hide rows beyond the limit
    for (let i = maxVisible; i < rows.length; i++) {
      rows[i].style.display = "none";
    }

    let expanded = false;

    seeMoreBtn.addEventListener("click", () => {
      expanded = !expanded;

      for (let i = maxVisible; i < rows.length; i++) {
        rows[i].style.display = expanded ? "table-row" : "none";
      }

      seeMoreBtn.textContent = expanded ? "See less" : "See more";
    });
  });
</script>