<section>
    <div class="content"></div>
  <div class="container">
    <h1>My File Repository</h1>

    <!-- Upload form -->
    <form action="/userd/repository/upload" method="POST" enctype="multipart/form-data" class="upload-form">
      <input type="file" name="file" required />
      <button type="submit">Upload File</button>
    </form>

    <hr />

    <!-- File Gallery -->
    <div class="gallery">
      <% if (files && files.length > 0) { %>
        <% files.forEach(file => { %>
          <div class="file-card">
            <strong><%= file.file_name %></strong>
            <div class="file-info">
              <span class="file-type"><%= file.file_type %></span>
              <br>
              Uploaded: <%= new Date(file.uploaded_at).toLocaleString() %>
            </div>
            <div class="actions">
              <a href="/uploads/repository/<%= file.file_path %>" target="_blank">
                <i class="fas fa-eye"></i> View
              </a>
              <a href="/uploads/repository/<%= file.file_path %>" download>
                <i class="fas fa-download"></i> Download
              </a>
              <a href="#" onclick="deleteFile('<%= file.id %>', '<%= file.file_name %>')" class="delete-btn">
                <i class="fas fa-trash"></i> Delete
              </a>
            </div>
            <div id="confirm-delete-<%= file.id %>" class="confirm-delete" style="display: none;">
              <p>Are you sure you want to delete this file?</p>
              <div class="confirm-actions">
                <form action="/userd/repository/delete/<%= file.id %>" method="POST">
                  <button type="submit" class="confirm-btn">Yes, Delete</button>
                </form>
                <button onclick="cancelDelete('<%= file.id %>')" class="cancel-btn">Cancel</button>
              </div>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <p>No files uploaded yet. Upload your first file using the form above.</p>
      <% } %>
    </div>

    <a href="/userd" class="b2d-link">Back to Dashboard</a>
  </div>
  </div>
</section>

<script>
function deleteFile(fileId, fileName) {
  // Hide any other open confirmation dialogs
  document.querySelectorAll('.confirm-delete').forEach(el => {
    el.style.display = 'none';
  });
  
  // Show the confirmation dialog for this file
  const confirmDialog = document.getElementById(`confirm-delete-${fileId}`);
  confirmDialog.style.display = 'block';
}

function cancelDelete(fileId) {
  // Hide the confirmation dialog
  const confirmDialog = document.getElementById(`confirm-delete-${fileId}`);
  confirmDialog.style.display = 'none';
}
</script>